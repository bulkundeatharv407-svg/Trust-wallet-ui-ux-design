<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
  <title>Fintech App • Admin Shows Passwords</title>
  <!-- Google Font: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:opsz,wght@14..32,400;14..32,500;14..32,600;14..32,700&display=swap" rel="stylesheet">
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- QR Code Generator and Scanner -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsqr/1.4.0/jsQR.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(145deg, #f5f0ff 0%, #e9e1fa 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 12px;
    }
    .app-wrapper {
      max-width: 400px;
      width: 100%;
      background: white;
      border-radius: 48px;
      box-shadow: 0 30px 60px rgba(95, 37, 159, 0.3);
      overflow: hidden;
      position: relative;
    }
    .auth-screen, .admin-screen { display: block; background: transparent; padding: 24px 20px 30px; }
    .admin-screen { display: none; }
    .app-screen { display: none; height: 780px; flex-direction: column; }
    .app-screen.show { display: flex; }
    .app-brand { text-align: center; margin-bottom: 24px; }
    .app-logo { font-size: 4rem; color: #5F259F; filter: drop-shadow(0 8px 12px rgba(95,37,159,0.2)); }
    .app-name { font-size: 2.5rem; font-weight: 700; color: #5F259F; letter-spacing: -0.5px; }
    .tagline { font-size: 1rem; color: #4a3b6e; font-weight: 500; opacity: 0.8; }
    .auth-card, .admin-card {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(12px);
      border-radius: 40px;
      padding: 30px 24px;
      box-shadow: 0 30px 50px -20px rgba(95,37,159,0.3);
      border: 1px solid rgba(255,255,255,0.5);
    }
    .input-group { margin-bottom: 20px; }
    .input-label { display: block; font-weight: 600; font-size: 0.9rem; color: #2c1b4a; margin-bottom: 8px; }
    .input-field-wrapper { position: relative; display: flex; align-items: center; }
    .input-field-wrapper i { position: absolute; left: 18px; color: #9b87c5; font-size: 1.2rem; }
    .input-field-wrapper input {
      width: 100%;
      padding: 18px 18px 18px 52px;
      border: 1px solid #e0d6f2;
      border-radius: 50px;
      font-size: 1rem;
      background: rgba(255,255,255,0.8);
      transition: 0.2s;
      font-family: 'Inter', sans-serif;
    }
    .input-field-wrapper input:focus {
      outline: none;
      border-color: #8a4fe0;
      box-shadow: 0 0 0 4px rgba(138,79,224,0.15);
      background: #ffffff;
    }
    .toggle-password { position: absolute; right: 18px; background: none; border: none; color: #8a6ebd; font-size: 1.3rem; cursor: pointer; }
    .btn-primary {
      background: linear-gradient(135deg, #7d3fc0, #5F259F);
      color: white; border: none; width: 100%;
      padding: 18px 24px; border-radius: 60px;
      font-weight: 700; font-size: 1.2rem;
      box-shadow: 0 12px 24px -8px #5F259F;
      cursor: pointer; transition: 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 18px 30px -8px #5F259F; }
    .btn-secondary {
      background: white; border: 1.5px solid #5F259F; color: #5F259F;
      padding: 14px 24px; border-radius: 50px; font-weight: 600; cursor: pointer;
      width: 100%; margin-top: 10px;
    }
    .auth-footer { text-align: center; margin-top: 20px; color: #4a3b6e; font-size: 0.95rem; }
    .auth-footer a { color: #5F259F; font-weight: 700; text-decoration: none; border-bottom: 1px solid #d5c2f0; cursor: pointer; }
    .powered { text-align: center; margin-top: 12px; font-size: 0.9rem; color: #8a6ebd; font-weight: 500; }
    .powered i { color: #e91e63; font-size: 0.9rem; }
    .error-msg { color: #d32f2f; font-size: 0.85rem; margin: 5px 0 0; }
    .success-msg { color: #2e7d32; background: #e8f5e9; border-radius: 50px; padding: 8px 16px; margin: 10px 0; }

    /* Admin Dashboard */
    .admin-header { background: #5F259F; padding: 20px 20px 12px; color: white; }
    .admin-header-row { display: flex; justify-content: space-between; align-items: center; }
    .admin-header h2 { font-weight: 600; font-size: 1.6rem; }
    .admin-header i { font-size: 1.8rem; cursor: pointer; }
    .admin-content { padding: 16px; background: #f8f7fc; overflow-y: auto; max-height: 600px; }
    .admin-card { background: white; border-radius: 28px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 25px -8px rgba(95,37,159,0.1); border: 1px solid #f0eaff; }
    .admin-card h3 { font-weight: 700; color: #1a1a2c; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
    .admin-card h3 i { color: #5F259F; }
    .user-list { max-height: 300px; overflow-y: auto; margin-top: 10px; }
    .user-item { display: flex; flex-direction: column; padding: 16px 0; border-bottom: 1px solid #f0f0f0; }
    .user-info { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    .user-info span { font-weight: 600; }
    .user-actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
    .action-btn { background: #f3eaff; border: none; border-radius: 30px; padding: 8px 14px; font-size: 0.8rem; font-weight: 600; color: #5F259F; cursor: pointer; display: inline-flex; align-items: center; gap: 5px; }
    .action-btn i { font-size: 0.9rem; }
    .action-btn:hover { background: #e1d1f7; }
    .blocked-badge { background: #ff5252; color: white; padding: 4px 8px; border-radius: 30px; font-size: 0.7rem; font-weight: 600; }
    .pagination { display: flex; justify-content: center; gap: 15px; margin: 15px 0; align-items: center; }
    .pagination button { background: #5F259F; color: white; border: none; border-radius: 30px; padding: 8px 16px; cursor: pointer; }
    .pagination button:disabled { opacity: 0.3; cursor: not-allowed; }
    .txn-list { max-height: 200px; overflow-y: auto; }
    .admin-txn-item { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #f0f0f0; font-size: 0.9rem; }
    .admin-txn-item span:first-child { font-weight: 500; }
    .admin-txn-item span:last-child { background: #f0eaff; padding: 4px 8px; border-radius: 30px; font-size: 0.75rem; font-weight: 600; color: #5F259F; }

    /* Edit modal */
    .modal-overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:2000; align-items: center; justify-content: center; }
    .modal-overlay.show { display: flex; }
    .edit-modal { background: white; border-radius: 40px; padding: 30px; max-width: 340px; width: 90%; box-shadow: 0 40px 70px rgba(0,0,0,0.4); }
    .edit-modal h3 { margin-bottom: 20px; color: #5F259F; }
    .edit-modal .input-group { margin-bottom: 15px; }
    .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
    .modal-actions button { flex:1; }

    /* App styles */
    .app-header { background: #5F259F; padding: 20px 20px 12px; color: white; }
    .header-row { display: flex; justify-content: space-between; align-items: center; }
    .greeting { display: flex; align-items: center; gap: 12px; }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: #ffffff; color: #5F259F; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.4rem; text-transform: uppercase; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .greeting h3 { font-weight: 600; font-size: 1.3rem; }
    .notification-badge { background: rgba(255,255,255,0.2); border-radius: 30px; padding: 8px 12px; display: flex; align-items: center; gap: 6px; position: relative; }
    .badge-dot { position: absolute; top: 5px; right: 5px; width: 10px; height: 10px; background: #ff5252; border-radius: 50%; border: 2px solid #5F259F; }
    .balance-section { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.12); border-radius: 60px; padding: 12px 18px; margin-top: 16px; backdrop-filter: blur(4px); }
    .balance-label { opacity: 0.8; font-size: 0.9rem; }
    .balance-amount { font-weight: 700; font-size: 1.6rem; letter-spacing: -0.5px; }
    .eye-icon { background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer; }

    .main-content { flex: 1; overflow-y: auto; padding: 16px 16px 80px; background: #f8f7fc; position: relative; }

    .home-camera-btn {
      position: fixed; bottom: 100px; right: 30px; background: #5F259F; color: white; width: 56px; height: 56px;
      border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem;
      box-shadow: 0 6px 12px rgba(95,37,159,0.3); cursor: pointer; z-index: 200; border: 2px solid white;
      transition: transform 0.2s; pointer-events: auto;
    }
    .home-camera-btn:hover { transform: scale(1.1); }
    .home-camera-btn.hidden { display: none; }

    .profile-camera-btn { background: #f3eaff; border: none; border-radius: 30px; padding: 8px 16px; font-size: 0.9rem; font-weight: 600; color: #5F259F; cursor: pointer; display: inline-flex; align-items: center; gap: 6px; margin-left: auto; }
    .profile-camera-btn i { font-size: 1.1rem; }
    .profile-camera-btn:hover { background: #e1d1f7; }

    .offers-carousel { display: flex; gap: 12px; overflow-x: auto; padding: 4px 0 16px; scrollbar-width: none; }
    .offers-carousel::-webkit-scrollbar { display: none; }
    .offer-card { background: linear-gradient(145deg, #fff, #f3ebff); border-radius: 24px; padding: 16px; min-width: 200px; box-shadow: 0 6px 14px rgba(95,37,159,0.08); border: 1px solid #e9ddfa; display: flex; align-items: center; gap: 12px; }
    .offer-icon { background: #5F259F; border-radius: 30px; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.6rem; }
    .section-title { display: flex; justify-content: space-between; align-items: center; margin: 16px 0 12px; }
    .section-title h3 { font-weight: 700; color: #1a1a2c; }
    .section-title a { color: #5F259F; font-size: 0.9rem; font-weight: 600; text-decoration: none; }

    .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
    .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
    .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }

    .icon-btn { background: white; border: 1px solid #eee; border-radius: 22px; padding: 12px 4px; display: flex; flex-direction: column; align-items: center; gap: 6px; font-weight: 500; font-size: 0.8rem; color: #2a1b3c; cursor: pointer; transition: 0.1s; }
    .icon-btn i { font-size: 1.4rem; color: #5F259F; }
    .icon-btn:active { background: #f2eaff; transform: scale(0.96); }

    .card { background: white; border-radius: 28px; padding: 20px; margin-bottom: 16px; box-shadow: 0 10px 25px -8px rgba(95,37,159,0.1); border: 1px solid #f0eaff; }
    .txn-item { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #f0f0f0; }
    .txn-left { display: flex; gap: 12px; align-items: center; }
    .txn-icon { width: 42px; height: 42px; background: #f3eaff; border-radius: 42px; display: flex; align-items: center; justify-content: center; color: #5F259F; }
    .txn-details { font-weight: 500; }
    .txn-details small { color: #888; font-size: 0.75rem; }
    .txn-amount { font-weight: 700; }
    .txn-amount.positive { color: #2e7d32; }
    .txn-amount.negative { color: #c62828; }

    .filter-chip { background: #f0f0f0; padding: 8px 16px; border-radius: 30px; font-size: 0.9rem; cursor: pointer; display: inline-block; margin-right: 8px; margin-bottom: 8px; }
    .filter-chip.active { background: #5F259F; color: white; }

    .input-field { width: 100%; padding: 16px 18px; border: 1px solid #ddd; border-radius: 40px; font-size: 1rem; margin: 8px 0; background: #fbfaff; }
    .input-field:focus { border-color: #5F259F; outline: none; box-shadow: 0 0 0 3px rgba(95,37,159,0.2); }

    .bottom-nav { display: flex; justify-content: space-around; align-items: center; padding: 10px 12px; background: white; border-top: 1px solid #eee; }
    .nav-item { display: flex; flex-direction: column; align-items: center; color: #aaa; font-size: 0.75rem; cursor: pointer; background: none; border: none; width: 60px; }
    .nav-item i { font-size: 1.5rem; margin-bottom: 2px; }
    .nav-item.active { color: #5F259F; font-weight: 600; }

    .tab-panel { display: none; }
    .active-panel { display: block; }

    .profile-row { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; border-bottom: 1px solid #f0f0f0; }
    .kyc-badge { background: #4caf50; color: white; padding: 4px 12px; border-radius: 50px; font-size: 0.8rem; }

    .overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5); z-index:999; }
    .modal-sim { background: white; border-radius: 40px; padding: 24px; position: fixed; top: 20%; left: 5%; right: 5%; max-width: 360px; margin: auto; box-shadow: 0 40px 70px rgba(0,0,0,0.3); z-index: 1000; display: none; }
    .modal-sim.show { display: block; }
    .overlay.show { display: block; }

    #qrCodeContainer { display: flex; justify-content: center; margin: 15px 0; }
    #qrCodeContainer canvas, #qrCodeContainer img { border-radius: 20px; padding: 10px; background: white; }

    #cameraModal { max-width: 380px; width: 95%; }
    #scannerContainer { width: 100%; height: 300px; background: #000; border-radius: 20px; overflow: hidden; position: relative; margin-bottom: 15px; }
    #scannerContainer video, #scannerContainer canvas { width: 100%; height: 100%; object-fit: cover; }
    .scanner-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 2px solid rgba(255,255,255,0.3); box-shadow: 0 0 0 9999px rgba(0,0,0,0.3); }

    .crypto-item { display: flex; flex-direction: column; padding: 12px 0; border-bottom: 1px solid #f0f0f0; }
    .crypto-row { display: flex; align-items: center; justify-content: space-between; width: 100%; }
    .crypto-left { display: flex; align-items: center; gap: 12px; }
    .crypto-icon { font-size: 2rem; color: #5F259F; }
    .crypto-name { font-weight: 600; }
    .crypto-price { font-weight: 600; color: #2e7d32; }
    .crypto-price.na { color: #888; font-style: italic; }
    .crypto-buttons { display: flex; gap: 8px; margin-top: 8px; margin-left: 52px; }
    .crypto-chart-btn, .crypto-buy-btn { background: #f3eaff; border: none; border-radius: 30px; padding: 6px 14px; font-size: 0.8rem; font-weight: 600; color: #5F259F; cursor: pointer; display: inline-flex; align-items: center; gap: 4px; }
    .crypto-chart-btn i, .crypto-buy-btn i { font-size: 0.9rem; }
    .crypto-chart-btn:hover, .crypto-buy-btn:hover { background: #e1d1f7; }
    .refresh-note { font-size: 0.7rem; color: #aaa; margin-top: 8px; text-align: right; }

    .float-arrow { position: fixed; bottom: 170px; right: 30px; background: #5F259F; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; z-index: 100; animation: bounce 1.5s infinite; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
    .float-arrow.show { opacity: 1; pointer-events: auto; }
    @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(10px); } }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <!-- AUTH SCREEN (login + signup) -->
    <div id="authScreen" class="auth-screen">
      <div class="app-brand">
        <div class="app-logo"><i class="fas fa-shield-alt"></i></div>
        <div class="app-name">FinTrust</div>
        <div class="tagline">Fast • Secure • Trusted</div>
      </div>
      <div id="loginCard" class="auth-card">
        <div class="input-group">
          <label class="input-label">Mobile number</label>
          <div class="input-field-wrapper">
            <i class="fas fa-mobile-alt"></i>
            <input type="tel" id="loginMobile" placeholder="10-digit mobile" maxlength="10">
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Password (min. 6 characters)</label>
          <div class="input-field-wrapper">
            <i class="fas fa-lock"></i>
            <input type="password" id="loginPassword" placeholder="••••••">
            <button class="toggle-password" id="toggleLoginPassword" type="button"><i class="far fa-eye"></i></button>
          </div>
          <div id="loginError" class="error-msg"></div>
        </div>
        <div class="forgot-row" style="text-align: right; margin: 10px 0 20px;">
          <a href="#" class="forgot-link" style="color:#5F259F;">Forgot password?</a>
        </div>
        <button class="btn-primary" id="loginBtn"><i class="fas fa-sign-in-alt"></i> Log in</button>
        <button class="btn-secondary" id="goToAdminBtn"><i class="fas fa-user-cog"></i> Admin Login</button>
        <div class="auth-footer">Don't have an account? <a id="showSignupLink">Sign up</a></div>
        <div class="powered"><i class="fas fa-heart" style="color: #e91e63;"></i> Powered by Atharv</div>
      </div>
      <div id="signupCard" class="auth-card" style="display: none;">
        <div class="input-group">
          <label class="input-label">Full name</label>
          <div class="input-field-wrapper">
            <i class="fas fa-user"></i>
            <input type="text" id="signupName" placeholder="John Doe">
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Email</label>
          <div class="input-field-wrapper">
            <i class="fas fa-envelope"></i>
            <input type="email" id="signupEmail" placeholder="john@example.com">
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Mobile number</label>
          <div class="input-field-wrapper">
            <i class="fas fa-mobile-alt"></i>
            <input type="tel" id="signupMobile" placeholder="10-digit mobile" maxlength="10">
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Password (min. 6 characters)</label>
          <div class="input-field-wrapper">
            <i class="fas fa-lock"></i>
            <input type="password" id="signupPassword" placeholder="••••••">
            <button class="toggle-password" id="toggleSignupPassword" type="button"><i class="far fa-eye"></i></button>
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Confirm password</label>
          <div class="input-field-wrapper">
            <i class="fas fa-lock"></i>
            <input type="password" id="signupConfirm" placeholder="••••••">
            <button class="toggle-password" id="toggleSignupConfirm" type="button"><i class="far fa-eye"></i></button>
          </div>
          <div id="signupError" class="error-msg"></div>
        </div>
        <button class="btn-primary" id="signupBtn"><i class="fas fa-user-plus"></i> Create account</button>
        <div class="auth-footer">Already have an account? <a id="showLoginLink">Log in</a></div>
        <div class="powered"><i class="fas fa-heart" style="color: #e91e63;"></i> Powered by Atharv</div>
      </div>
    </div>

    <!-- ADMIN LOGIN SCREEN -->
    <div id="adminScreen" class="admin-screen" style="display: none;">
      <div class="app-brand">
        <div class="app-logo"><i class="fas fa-shield-alt"></i></div>
        <div class="app-name">Admin Panel</div>
        <div class="tagline">Secure Access</div>
      </div>
      <div class="auth-card">
        <h3 style="margin-bottom: 16px;">Admin Login</h3>
        <div class="input-group">
          <label class="input-label">Username</label>
          <div class="input-field-wrapper">
            <i class="fas fa-user"></i>
            <input type="text" id="adminUser" placeholder="BOIAT001">
          </div>
        </div>
        <div class="input-group">
          <label class="input-label">Password</label>
          <div class="input-field-wrapper">
            <i class="fas fa-lock"></i>
            <input type="password" id="adminPass" placeholder="••••••">
          </div>
          <div id="adminError" class="error-msg"></div>
        </div>
        <button class="btn-primary" id="adminLoginBtn"><i class="fas fa-sign-in-alt"></i> Enter Dashboard</button>
        <button class="btn-secondary" id="backFromAdminBtn">Back to User Login</button>
        <div class="powered"><i class="fas fa-heart" style="color: #e91e63;"></i> Powered by Atharv</div>
      </div>
    </div>

    <!-- ADMIN DASHBOARD (with pagination) -->
    <div id="adminDashboard" class="admin-screen" style="display: none;">
      <div class="admin-header">
        <div class="admin-header-row">
          <h2><i class="fas fa-user-cog"></i> Admin</h2>
          <i class="fas fa-sign-out-alt" id="adminLogoutBtn" style="cursor:pointer;"></i>
        </div>
        <div style="margin-top: 10px; opacity:0.8;">BOIAT001 • Total Users: <span id="totalUserCount">0</span></div>
      </div>
      <div class="admin-content">
        <div class="admin-card">
          <h3><i class="fas fa-users"></i> Registered Users</h3>
          <div id="adminUserList" class="user-list"></div>
          <div class="pagination">
            <button id="prevPageBtn" disabled>◀ Prev</button>
            <span id="pageIndicator">Page 1 of 1</span>
            <button id="nextPageBtn" disabled>Next ▶</button>
          </div>
        </div>
        <div class="admin-card" id="userHistoryCard" style="display: none;">
          <h3><i class="fas fa-history"></i> <span id="historyUserName"></span>'s Transactions</h3>
          <div id="userTransactionList" class="txn-list"></div>
          <button class="btn-secondary" id="closeHistoryBtn" style="margin-top:10px;">Close History</button>
        </div>
        <button class="btn-secondary" id="adminBackToLogin" style="margin-top:0;">Back to Admin Login</button>
      </div>
    </div>

    <!-- Edit User Modal -->
    <div class="modal-overlay" id="editModal">
      <div class="edit-modal">
        <h3>Edit User</h3>
        <div class="input-group">
          <label class="input-label">Name</label>
          <input type="text" id="editName" class="input-field">
        </div>
        <div class="input-group">
          <label class="input-label">Email</label>
          <input type="email" id="editEmail" class="input-field">
        </div>
        <div class="input-group">
          <label class="input-label">Password (leave blank to keep)</label>
          <input type="password" id="editPassword" class="input-field" placeholder="New password">
        </div>
        <div class="modal-actions">
          <button class="btn-primary" id="saveEditBtn">Save</button>
          <button class="btn-secondary" id="cancelEditBtn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- USER APP SCREEN -->
    <div id="appScreen" class="app-screen">
      <div class="app-header">
        <div class="header-row">
          <div class="greeting">
            <div class="user-avatar" id="userAvatar">J</div>
            <h3><span id="greetingName">John</span>, <span id="greetingMsg">Good evening</span></h3>
          </div>
          <div class="notification-badge"><i class="fas fa-bell"></i><span class="badge-dot"></span></div>
        </div>
        <div class="balance-section">
          <span class="balance-label">Wallet balance</span>
          <span class="balance-amount" id="walletBalance">₹0.00</span>
          <button class="eye-icon" id="toggleBalance"><i class="fas fa-eye"></i></button>
        </div>
      </div>

      <div class="main-content">
        <!-- HOME PANEL -->
        <div id="homePanel" class="tab-panel active-panel">
          <div class="offers-carousel">
            <div class="offer-card"><div class="offer-icon"><i class="fas fa-gift"></i></div><div class="offer-details"><h4>Cashback 10%</h4><p>on first recharges</p></div></div>
            <div class="offer-card"><div class="offer-icon"><i class="fas fa-shield-alt"></i></div><div class="offer-details"><h4>Insurance</h4><p>starting ₹99</p></div></div>
            <div class="offer-card"><div class="offer-icon"><i class="fas fa-chart-line"></i></div><div class="offer-details"><h4>Mutual funds</h4><p>zero commission</p></div></div>
          </div>
          <div class="section-title"><h3>Quick actions</h3><a href="#">View all</a></div>
          <div class="grid-4">
            <button class="icon-btn" id="sendToMobileQuick"><i class="fas fa-mobile-alt"></i>Mobile</button>
            <button class="icon-btn" id="scanQrQuick"><i class="fas fa-qrcode"></i>Scan QR</button>
            <button class="icon-btn" id="requestQuick"><i class="fas fa-hand-holding-usd"></i>Request</button>
            <button class="icon-btn" id="splitQuick"><i class="fas fa-users"></i>Split</button>
            <button class="icon-btn" id="insuranceQuick"><i class="fas fa-shield"></i>Insure</button>
            <button class="icon-btn" id="wealthQuick"><i class="fas fa-coins"></i>Wealth</button>
            <button class="icon-btn" id="ccQuick"><i class="fas fa-credit-card"></i>Cards</button>
            <button class="icon-btn" id="loanQuick"><i class="fas fa-hand-holding"></i>Loans</button>
          </div>

          <!-- Add Money Card (Home) -->
          <div class="card" style="margin-bottom: 16px;">
            <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;"><i class="fas fa-wallet" style="color:#5F259F;"></i> Add Money to Wallet</h3>
            <div class="input-group" style="margin-bottom: 12px;">
              <label class="input-label">Phone Number</label>
              <div class="input-field-wrapper">
                <i class="fas fa-phone-alt"></i>
                <input type="tel" id="addPhoneHome" placeholder="10-digit mobile" maxlength="10">
              </div>
            </div>
            <div class="input-group" style="margin-bottom: 12px;">
              <label class="input-label">Password</label>
              <div class="input-field-wrapper">
                <i class="fas fa-lock"></i>
                <input type="password" id="addPasswordHome" placeholder="••••••">
                <button class="toggle-password" id="toggleAddPasswordHome" type="button"><i class="far fa-eye"></i></button>
              </div>
            </div>
            <div class="input-group" style="margin-bottom: 12px;">
              <label class="input-label">Amount (₹)</label>
              <div class="input-field-wrapper">
                <i class="fas fa-rupee-sign"></i>
                <input type="number" id="addAmountHome" placeholder="0" min="1">
              </div>
            </div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
              <button class="btn-primary" id="addMoneyBtnHome" style="flex:2;"><i class="fas fa-plus-circle"></i> Add Money</button>
              <button class="btn-secondary" id="generateCodeBtnHome" style="flex:1;"><i class="fas fa-qrcode"></i> Code</button>
            </div>
            <div id="addMoneyMessageHome" style="margin-top: 12px;"></div>
            <div id="generatedCodeDisplayHome" style="margin-top: 8px; font-weight: 500; color: #5F259F; text-align: center;"></div>
          </div>

          <!-- Crypto Market Card -->
          <div class="card" style="margin-bottom: 16px;">
            <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;"><i class="fas fa-bitcoin" style="color:#5F259F;"></i> Crypto Market <span style="font-size:0.7rem; margin-left:auto; color:#888;" id="cryptoUpdateTime"></span></h3>
            <div id="cryptoListContainer"></div>
            <div class="refresh-note">Prices update every 5 min via CoinGecko</div>
          </div>

          <div class="section-title"><h3>Recent transactions</h3><a href="#" id="viewAllHistory">view all</a></div>
          <div id="recentTransactionsHome" class="card" style="padding: 12px;"></div>
          <div class="section-title"><h3>Explore more</h3></div>
          <div class="grid-2">
            <button class="icon-btn" id="insuranceExplore"><i class="fas fa-umbrella"></i> Insurance</button>
            <button class="icon-btn" id="mutualExplore"><i class="fas fa-chart-pie"></i> Mutual Funds</button>
            <button class="icon-btn" id="goldExplore"><i class="fas fa-coins"></i> Digital Gold</button>
            <button class="icon-btn" id="taxExplore"><i class="fas fa-file-invoice"></i> Tax Payment</button>
          </div>
        </div>

        <!-- CRYPTO PANEL -->
        <div id="cryptoPanel" class="tab-panel">
          <div class="card">
            <h3><i class="fas fa-bitcoin"></i> Crypto Market <span style="font-size:0.7rem; margin-left:auto; color:#888;" id="cryptoPanelUpdateTime"></span></h3>
            <div id="cryptoPanelList"></div>
            <div class="refresh-note">Real-time prices via CoinGecko API • 5min cache</div>
          </div>
        </div>

        <!-- TRANSFER PANEL -->
        <div id="transferPanel" class="tab-panel"><div class="card"><h3>Send money</h3><div class="grid-2"><button class="icon-btn" id="sendToContact"><i class="fas fa-user"></i> To contact</button><button class="icon-btn" id="sendToBank"><i class="fas fa-university"></i> To bank</button><button class="icon-btn" id="sendToSelf"><i class="fas fa-exchange-alt"></i> Self transfer</button><button class="icon-btn" id="requestMoney"><i class="fas fa-hand-holding-heart"></i> Request</button><button class="icon-btn" id="splitBillBtn"><i class="fas fa-users"></i> Split bill</button></div><div id="transferFormContainer"></div><div id="transferMessage"></div></div></div>

        <!-- HISTORY PANEL -->
        <div id="historyPanel" class="tab-panel"><div class="card"><h3>Transaction history</h3><div id="historyFilters"></div><div id="transactionList"></div></div></div>

        <!-- PROFILE PANEL -->
        <div id="profilePanel" class="tab-panel">
          <div class="card">
            <div style="display: flex; align-items: center; gap: 16px;">
              <i class="fas fa-user-circle" style="font-size: 4rem; color: #5F259F;"></i>
              <div style="flex:1;">
                <h3 id="profileName">John Doe</h3>
                <span id="profileMobile">+91 98765 43210</span><br>
                <small id="profileEmail">john@payapp</small>
              </div>
              <button class="profile-camera-btn" id="profileCameraBtn"><i class="fas fa-camera"></i> Scan</button>
            </div>
            <div style="margin:20px 0;">
              <div class="profile-row"><span>KYC status</span> <span class="kyc-badge">Verified</span></div>
              <div class="profile-row"><span>Bank accounts</span> <span>2 linked</span></div>
              <div class="profile-row"><span>UPI PIN</span> <span>••••</span></div>
            </div>

            <!-- Add Money Card (Profile) -->
            <div style="margin: 20px 0;">
              <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;"><i class="fas fa-wallet" style="color:#5F259F;"></i> Add Money</h3>
              <div class="input-group" style="margin-bottom: 12px;">
                <label class="input-label">Phone Number</label>
                <div class="input-field-wrapper">
                  <i class="fas fa-phone-alt"></i>
                  <input type="tel" id="addPhoneProfile" placeholder="10-digit mobile" maxlength="10">
                </div>
              </div>
              <div class="input-group" style="margin-bottom: 12px;">
                <label class="input-label">Password</label>
                <div class="input-field-wrapper">
                  <i class="fas fa-lock"></i>
                  <input type="password" id="addPasswordProfile" placeholder="••••••">
                  <button class="toggle-password" id="toggleAddPasswordProfile" type="button"><i class="far fa-eye"></i></button>
                </div>
              </div>
              <div class="input-group" style="margin-bottom: 12px;">
                <label class="input-label">Amount (₹)</label>
                <div class="input-field-wrapper">
                  <i class="fas fa-rupee-sign"></i>
                  <input type="number" id="addAmountProfile" placeholder="0" min="1">
                </div>
              </div>
              <div style="display: flex; gap: 10px; margin-top: 10px;">
                <button class="btn-primary" id="addMoneyBtnProfile" style="flex:2;"><i class="fas fa-plus-circle"></i> Add Money</button>
                <button class="btn-secondary" id="generateCodeBtnProfile" style="flex:1;"><i class="fas fa-qrcode"></i> Code</button>
              </div>
              <div id="addMoneyMessageProfile" style="margin-top: 12px;"></div>
              <div id="generatedCodeDisplayProfile" style="margin-top: 8px; font-weight: 500; color: #5F259F; text-align: center;"></div>
            </div>

            <button class="btn-primary" style="width:100%;" id="changeUpiPinBtn"><i class="fas fa-lock"></i> Change UPI PIN</button>
            <button class="btn-secondary" style="width:100%; margin-top:12px;" id="viewBankAccounts">View bank accounts</button>
            <button class="btn-secondary" style="width:100%; margin-top:12px;" id="logoutBtn">Logout</button>
            <div id="profileMessage"></div>
          </div>
        </div>
      </div>

      <!-- Floating camera button (home only) -->
      <div class="home-camera-btn" id="homeCameraBtn"><i class="fas fa-camera"></i></div>

      <div class="bottom-nav">
        <button class="nav-item active" data-tab="home"><i class="fas fa-home"></i>Home</button>
        <button class="nav-item" data-tab="crypto"><i class="fas fa-bitcoin"></i>Crypto</button>
        <button class="nav-item" data-tab="transfer"><i class="fas fa-arrow-right"></i>Transfer</button>
        <button class="nav-item" data-tab="history"><i class="fas fa-clock"></i>History</button>
        <button class="nav-item" data-tab="profile"><i class="fas fa-user"></i>Profile</button>
      </div>
    </div>

    <!-- QR Modal -->
    <div class="overlay" id="overlay"></div>
    <div class="modal-sim" id="qrModal">
      <h3><i class="fas fa-qrcode"></i> Scan QR Code</h3>
      <p style="margin: 10px 0; font-size:0.9rem;">Your QR code (share to receive money):</p>
      <div id="qrCodeContainer"></div>
      <p style="margin: 10px 0; font-weight:500;">Mobile: <span id="qrMobileDisplay"></span></p>
      <hr style="margin:15px 0;">
      <h4>Pay via QR</h4>
      <div class="input-group" style="margin-bottom: 12px;">
        <label class="input-label">Recipient Mobile (from scan)</label>
        <div class="input-field-wrapper">
          <i class="fas fa-mobile-alt"></i>
          <input type="tel" id="qrRecipientMobile" placeholder="10-digit mobile" maxlength="10">
        </div>
      </div>
      <div class="input-group" style="margin-bottom: 12px;">
        <label class="input-label">Amount (₹)</label>
        <div class="input-field-wrapper">
          <i class="fas fa-rupee-sign"></i>
          <input type="number" id="qrAmount" placeholder="0" min="1">
        </div>
      </div>
      <div class="input-group" style="margin-bottom: 12px;">
        <label class="input-label">Your Password</label>
        <div class="input-field-wrapper">
          <i class="fas fa-lock"></i>
          <input type="password" id="qrPassword" placeholder="••••••">
          <button class="toggle-password" id="toggleQrPassword" type="button"><i class="far fa-eye"></i></button>
        </div>
      </div>
      <button class="btn-primary" id="qrPayBtn"><i class="fas fa-paper-plane"></i> Pay Now</button>
      <div id="qrMessage" style="margin-top: 10px;"></div>
      <button class="btn-secondary" id="closeQrModal" style="margin-top:15px;">Close</button>
    </div>

    <!-- Camera Scanner Modal -->
    <div class="overlay" id="cameraOverlay"></div>
    <div class="modal-sim" id="cameraModal">
      <h3><i class="fas fa-camera"></i> Scan QR Code</h3>
      <div id="scannerContainer">
        <video id="scannerVideo" autoplay playsinline></video>
        <canvas id="scannerCanvas" style="display:none;"></canvas>
        <div class="scanner-overlay"></div>
      </div>
      <p style="text-align:center; margin:10px 0;">Align QR code within the frame</p>
      <button class="btn-secondary" id="closeCameraBtn">Close Camera</button>
    </div>

    <!-- Floating down arrow -->
    <div class="float-arrow" id="floatArrow" onclick="document.querySelector('.main-content').scrollBy({ top: 300, behavior: 'smooth' });">
      <i class="fas fa-arrow-down"></i>
    </div>
  </div>

  <script>
    (function() {
      // ---------- PERSISTENCE WITH LOCALSTORAGE ----------
      const STORAGE_KEY = 'fintechUsers';

      function saveToLocalStorage() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(registeredUsers));
        } catch (e) {
          console.warn('LocalStorage quota exceeded', e);
        }
      }

      // START WITH ZERO PRELOADED USERS, BUT LOAD ANY EXISTING FROM LOCALSTORAGE
      let registeredUsers = [];
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        try {
          registeredUsers = JSON.parse(stored);
          console.log(`Loaded ${registeredUsers.length} users from localStorage`);
        } catch (e) {
          console.error('Failed to parse stored users', e);
          registeredUsers = [];
        }
      }

      // ---------- CRYPTO PRICE FETCHING ----------
      const coins = [
        { id: 'bitcoin', name: 'Bitcoin (BTC)', symbol: 'BTCUSDT', icon: 'fab fa-bitcoin' },
        { id: 'ethereum', name: 'Ethereum (ETH)', symbol: 'ETHUSDT', icon: 'fab fa-ethereum' },
        { id: 'litecoin', name: 'Litecoin (LTC)', symbol: 'LTCUSDT', icon: 'fas fa-coins' },
        { id: 'ripple', name: 'Ripple (XRP)', symbol: 'XRPUSDT', icon: 'fas fa-circle' },
        { id: 'solana', name: 'Solana (SOL)', symbol: 'SOLUSDT', icon: 'fab fa-solana' }
      ];

      async function fetchCryptoPrices() {
        const ids = coins.map(c => c.id).join(',');
        const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`;
        try {
          const response = await fetch(url);
          if (!response.ok) throw new Error('API error');
          const data = await response.json();
          const now = new Date().toLocaleTimeString();
          document.getElementById('cryptoUpdateTime').innerText = `Updated ${now}`;
          document.getElementById('cryptoPanelUpdateTime').innerText = `Updated ${now}`;
          renderCryptoLists(data);
        } catch (error) {
          console.warn('CoinGecko fetch failed, using fallback', error);
          renderCryptoLists(null);
        }
      }

      function renderCryptoLists(priceData) {
        const container = document.getElementById('cryptoListContainer');
        const panelContainer = document.getElementById('cryptoPanelList');
        if (!container || !panelContainer) return;

        let homeHtml = '';
        let panelHtml = '';

        coins.forEach(coin => {
          let price = priceData && priceData[coin.id] ? `$${priceData[coin.id].usd.toLocaleString()}` : '—';
          let priceClass = priceData && priceData[coin.id] ? 'crypto-price' : 'crypto-price na';
          const chartUrl = `https://www.tradingview.com/symbols/${coin.symbol}/`;
          const buttonHtml = `
            <div class="crypto-buttons">
              <button class="crypto-chart-btn" onclick="window.open('${chartUrl}', '_blank')"><i class="fas fa-chart-line"></i> Chart</button>
              <button class="crypto-buy-btn" onclick="alert('Buy ${coin.name} - integration coming soon')"><i class="fas fa-shopping-cart"></i> Buy</button>
            </div>
          `;
          const itemHtml = `
            <div class="crypto-item">
              <div class="crypto-row">
                <div class="crypto-left">
                  <i class="${coin.icon} crypto-icon"></i>
                  <span class="crypto-name">${coin.name}</span>
                </div>
                <span class="${priceClass}">${price}</span>
              </div>
              ${buttonHtml}
            </div>
          `;
          homeHtml += itemHtml;
          panelHtml += itemHtml;
        });

        container.innerHTML = homeHtml;
        panelContainer.innerHTML = panelHtml;
      }

      fetchCryptoPrices();
      setInterval(fetchCryptoPrices, 300000);

      // ---------- DOM elements ----------
      const authScreen = document.getElementById('authScreen');
      const adminScreen = document.getElementById('adminScreen');
      const adminDashboard = document.getElementById('adminDashboard');
      const appScreen = document.getElementById('appScreen');
      const loginCard = document.getElementById('loginCard');
      const signupCard = document.getElementById('signupCard');
      const showSignupLink = document.getElementById('showSignupLink');
      const showLoginLink = document.getElementById('showLoginLink');
      const goToAdminBtn = document.getElementById('goToAdminBtn');
      const backFromAdminBtn = document.getElementById('backFromAdminBtn');
      const adminLoginBtn = document.getElementById('adminLoginBtn');
      const adminLogoutBtn = document.getElementById('adminLogoutBtn');
      const adminBackToLogin = document.getElementById('adminBackToLogin');
      const editModal = document.getElementById('editModal');
      const editName = document.getElementById('editName');
      const editEmail = document.getElementById('editEmail');
      const editPassword = document.getElementById('editPassword');
      const saveEditBtn = document.getElementById('saveEditBtn');
      const cancelEditBtn = document.getElementById('cancelEditBtn');
      const totalUserCountSpan = document.getElementById('totalUserCount');
      const adminUserList = document.getElementById('adminUserList');
      const prevPageBtn = document.getElementById('prevPageBtn');
      const nextPageBtn = document.getElementById('nextPageBtn');
      const pageIndicator = document.getElementById('pageIndicator');
      const floatArrow = document.getElementById('floatArrow');
      const userAvatar = document.getElementById('userAvatar');
      
      const qrModal = document.getElementById('qrModal');
      const overlay = document.getElementById('overlay');
      const qrCodeContainer = document.getElementById('qrCodeContainer');
      const qrMobileDisplay = document.getElementById('qrMobileDisplay');
      const qrRecipientMobile = document.getElementById('qrRecipientMobile');
      const qrAmount = document.getElementById('qrAmount');
      const qrPassword = document.getElementById('qrPassword');
      const qrPayBtn = document.getElementById('qrPayBtn');
      const qrMessage = document.getElementById('qrMessage');
      const closeQrModal = document.getElementById('closeQrModal');

      const homeCameraBtn = document.getElementById('homeCameraBtn');
      const profileCameraBtn = document.getElementById('profileCameraBtn');
      const cameraModal = document.getElementById('cameraModal');
      const cameraOverlay = document.getElementById('cameraOverlay');
      const closeCameraBtn = document.getElementById('closeCameraBtn');
      const scannerVideo = document.getElementById('scannerVideo');
      const scannerCanvas = document.getElementById('scannerCanvas');
      let cameraStream = null;
      let scanInterval = null;

      // Pagination state
      let currentPage = 1;
      const pageSize = 10;
      let totalPages = Math.ceil(registeredUsers.length / pageSize) || 1;

      let currentEditingUser = null;

      function showFloatArrow() {
        floatArrow.classList.add('show');
        setTimeout(() => { floatArrow.classList.remove('show'); }, 4000);
      }

      function setupToggle(btnId, inputId) {
        const btn = document.getElementById(btnId);
        const input = document.getElementById(inputId);
        if (btn && input) {
          btn.addEventListener('click', function() {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);
            btn.innerHTML = type === 'password' ? '<i class="far fa-eye"></i>' : '<i class="far fa-eye-slash"></i>';
          });
        }
      }
      setupToggle('toggleLoginPassword', 'loginPassword');
      setupToggle('toggleSignupPassword', 'signupPassword');
      setupToggle('toggleSignupConfirm', 'signupConfirm');
      setupToggle('toggleAddPasswordHome', 'addPasswordHome');
      setupToggle('toggleAddPasswordProfile', 'addPasswordProfile');
      setupToggle('toggleQrPassword', 'qrPassword');

      document.getElementById('loginMobile')?.addEventListener('input', function(e) { this.value = this.value.replace(/\D/g, '').slice(0, 10); });
      document.getElementById('signupMobile')?.addEventListener('input', function(e) { this.value = this.value.replace(/\D/g, '').slice(0, 10); });
      if (qrRecipientMobile) qrRecipientMobile.addEventListener('input', function(e) { this.value = this.value.replace(/\D/g, '').slice(0, 10); });

      showSignupLink.addEventListener('click', (e) => { e.preventDefault(); loginCard.style.display = 'none'; signupCard.style.display = 'block'; });
      showLoginLink.addEventListener('click', (e) => { e.preventDefault(); signupCard.style.display = 'none'; loginCard.style.display = 'block'; document.getElementById('loginError').innerText = ''; });

      goToAdminBtn.addEventListener('click', () => { authScreen.style.display = 'none'; adminScreen.style.display = 'block'; });
      backFromAdminBtn.addEventListener('click', () => { adminScreen.style.display = 'none'; authScreen.style.display = 'block'; document.getElementById('adminError').innerText = ''; });

      adminLoginBtn.addEventListener('click', (e) => {
        e.preventDefault();
        const user = document.getElementById('adminUser').value;
        const pass = document.getElementById('adminPass').value;
        if (user === 'BOIAT001' && pass === 'admin123') {
          adminScreen.style.display = 'none';
          adminDashboard.style.display = 'block';
          totalUserCountSpan.innerText = registeredUsers.length;
          renderAdminDashboard();
        } else {
          document.getElementById('adminError').innerText = 'Invalid credentials (use BOIAT001 / admin123)';
        }
      });

      adminLogoutBtn.addEventListener('click', () => { adminDashboard.style.display = 'none'; authScreen.style.display = 'block'; loginCard.style.display = 'block'; signupCard.style.display = 'none'; document.getElementById('userHistoryCard').style.display = 'none'; });
      adminBackToLogin.addEventListener('click', () => { adminDashboard.style.display = 'none'; adminScreen.style.display = 'block'; document.getElementById('userHistoryCard').style.display = 'none'; });

      document.getElementById('closeHistoryBtn').addEventListener('click', () => { document.getElementById('userHistoryCard').style.display = 'none'; });

      cancelEditBtn.addEventListener('click', () => { editModal.classList.remove('show'); currentEditingUser = null; });

      saveEditBtn.addEventListener('click', () => {
        if (!currentEditingUser) return;
        const user = registeredUsers.find(u => u.mobile === currentEditingUser);
        if (user) {
          user.name = editName.value.trim();
          user.email = editEmail.value.trim();
          if (editPassword.value.trim() !== '') {
            if (editPassword.value.length >= 6) {
              user.password = editPassword.value;
            } else {
              alert('Password must be at least 6 characters');
              return;
            }
          }
          editModal.classList.remove('show');
          saveToLocalStorage();
          renderAdminDashboard();
        }
      });

      function renderAdminDashboard() {
        const start = (currentPage - 1) * pageSize;
        const end = start + pageSize;
        const pageUsers = registeredUsers.slice(start, end);

        if (pageUsers.length === 0) {
          adminUserList.innerHTML = '<p style="padding:10px 0;">No users registered yet.</p>';
        } else {
          let html = '';
          pageUsers.forEach(u => {
            const activeStatus = u.active !== false ? 'Active' : 'Blocked';
            const statusClass = u.active === false ? 'blocked-badge' : '';
            html += `
              <div class="user-item">
                <div class="user-info">
                  <span>${u.name}</span>
                  <span class="${statusClass}">${activeStatus}</span>
                </div>
                <div><small>${u.email} | ${u.mobile}</small></div>
                <div><small>Password: ${u.password}</small></div>
                <div class="user-actions">
                  <button class="action-btn" onclick="viewUserHistory('${u.mobile}')"><i class="fas fa-history"></i> History</button>
                  <button class="action-btn" onclick="editUser('${u.mobile}')"><i class="fas fa-edit"></i> Edit</button>
                  <button class="action-btn" onclick="toggleBlockUser('${u.mobile}')"><i class="fas fa-ban"></i> ${u.active === false ? 'Unblock' : 'Block'}</button>
                </div>
              </div>
            `;
          });
          adminUserList.innerHTML = html;
        }

        totalPages = Math.ceil(registeredUsers.length / pageSize) || 1;
        pageIndicator.innerText = `Page ${currentPage} of ${totalPages}`;
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages || registeredUsers.length === 0;
      }

      prevPageBtn.addEventListener('click', () => { if (currentPage > 1) { currentPage--; renderAdminDashboard(); } });
      nextPageBtn.addEventListener('click', () => { if (currentPage < totalPages) { currentPage++; renderAdminDashboard(); } });

      window.viewUserHistory = function(mobile) {
        const user = registeredUsers.find(u => u.mobile === mobile);
        if (!user) return;
        document.getElementById('historyUserName').innerText = user.name;
        const userTxns = user.transactions || [];
        let txnHtml = '';
        if (userTxns.length === 0) {
          txnHtml = '<p>No transactions yet.</p>';
        } else {
          userTxns.slice().reverse().forEach(t => {
            txnHtml += `<div class="admin-txn-item"><span>${t.desc}</span> <span>₹${t.amount}</span> <span>${t.date}</span> <span>${t.status}</span></div>`;
          });
        }
        document.getElementById('userTransactionList').innerHTML = txnHtml;
        document.getElementById('userHistoryCard').style.display = 'block';
      };

      window.editUser = function(mobile) {
        const user = registeredUsers.find(u => u.mobile === mobile);
        if (!user) return;
        currentEditingUser = mobile;
        editName.value = user.name;
        editEmail.value = user.email;
        editPassword.value = '';
        editModal.classList.add('show');
      };

      window.toggleBlockUser = function(mobile) {
        const user = registeredUsers.find(u => u.mobile === mobile);
        if (user) {
          user.active = user.active === false ? true : false;
          saveToLocalStorage();
          renderAdminDashboard();
        }
      };

      document.getElementById('signupBtn').addEventListener('click', (e) => {
        e.preventDefault();
        const name = document.getElementById('signupName').value.trim();
        const email = document.getElementById('signupEmail').value.trim();
        const mobile = document.getElementById('signupMobile').value.trim();
        const password = document.getElementById('signupPassword').value;
        const confirm = document.getElementById('signupConfirm').value;
        const errorDiv = document.getElementById('signupError');

        if (!name || !email || !mobile || !password || !confirm) {
          errorDiv.innerText = 'All fields are required';
          return;
        }
        if (mobile.length !== 10) {
          errorDiv.innerText = 'Mobile must be 10 digits';
          return;
        }
        if (password.length < 6) {
          errorDiv.innerText = 'Password must be at least 6 characters';
          return;
        }
        if (password !== confirm) {
          errorDiv.innerText = 'Passwords do not match';
          return;
        }
        if (registeredUsers.some(u => u.mobile === mobile)) {
          errorDiv.innerText = 'Mobile number already registered';
          return;
        }

        const newUser = { name, email, mobile, password, active: true, transactions: [], balance: 0 };
        registeredUsers.push(newUser);
        totalUserCountSpan.innerText = registeredUsers.length;
        totalPages = Math.ceil(registeredUsers.length / pageSize) || 1;
        saveToLocalStorage();
        errorDiv.innerText = '';
        alert('Account created successfully! Please log in.');
        signupCard.style.display = 'none';
        loginCard.style.display = 'block';
        document.getElementById('signupName').value = '';
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupMobile').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('signupConfirm').value = '';
      });

      document.getElementById('loginBtn').addEventListener('click', (e) => {
        e.preventDefault();
        const mobile = document.getElementById('loginMobile').value.trim();
        const password = document.getElementById('loginPassword').value;
        const errorDiv = document.getElementById('loginError');

        if (!mobile || !password) {
          errorDiv.innerText = 'Mobile and password required';
          return;
        }
        if (mobile.length !== 10) {
          errorDiv.innerText = 'Invalid mobile number';
          return;
        }
        if (password.length < 6) {
          errorDiv.innerText = 'Password must be at least 6 characters';
          return;
        }

        const user = registeredUsers.find(u => u.mobile === mobile && u.password === password);
        if (!user) {
          errorDiv.innerText = 'Invalid mobile or password';
          return;
        }
        if (user.active === false) {
          errorDiv.innerText = 'Your account is blocked. Contact admin.';
          return;
        }

        authScreen.style.display = 'none';
        appScreen.classList.add('show');
        initializeApp(user);
      });

      function initializeApp(user) {
        let currentUser = user;
        let currentUserBalance = currentUser.balance || 0;
        if (!currentUser.transactions) currentUser.transactions = [];

        if (userAvatar) {
          const firstLetter = user.name ? user.name.charAt(0).toUpperCase() : '?';
          userAvatar.innerText = firstLetter;
        }

        document.getElementById('greetingName').innerText = currentUser.name.split(' ')[0];
        document.getElementById('profileName').innerText = currentUser.name;
        document.getElementById('profileMobile').innerText = '+91 ' + currentUser.mobile;
        document.getElementById('profileEmail').innerText = currentUser.email;

        function updateBalanceUI() { document.getElementById('walletBalance').innerText = '₹' + currentUserBalance.toFixed(2); }

        let balanceVisible = true;
        document.getElementById('toggleBalance').onclick = () => {
          const balSpan = document.getElementById('walletBalance');
          if(balanceVisible) {
            balSpan.innerText = '••••••';
            document.getElementById('toggleBalance').innerHTML = '<i class="fas fa-eye-slash"></i>';
          } else {
            balSpan.innerText = '₹' + currentUserBalance.toFixed(2);
            document.getElementById('toggleBalance').innerHTML = '<i class="fas fa-eye"></i>';
          }
          balanceVisible = !balanceVisible;
        };

        const hours = new Date().getHours();
        let greet = hours < 12 ? 'Good morning' : hours < 17 ? 'Good afternoon' : 'Good evening';
        document.getElementById('greetingMsg').innerText = greet;

        const panels = {
          home: document.getElementById('homePanel'),
          crypto: document.getElementById('cryptoPanel'),
          transfer: document.getElementById('transferPanel'),
          history: document.getElementById('historyPanel'),
          profile: document.getElementById('profilePanel')
        };
        const navItems = document.querySelectorAll('.nav-item');
        function switchTab(tabId) {
          Object.values(panels).forEach(p => p.classList.remove('active-panel'));
          panels[tabId].classList.add('active-panel');
          navItems.forEach(item => item.classList.remove('active'));
          document.querySelector(`.nav-item[data-tab="${tabId}"]`).classList.add('active');
          if (tabId === 'home') {
            homeCameraBtn.classList.remove('hidden');
          } else {
            homeCameraBtn.classList.add('hidden');
          }
          if (tabId === 'history') renderTransactionList('all');
          if (tabId === 'home') renderRecentHome();
        }
        navItems.forEach(item => {
          item.addEventListener('click', (e) => { const tab = e.currentTarget.getAttribute('data-tab'); switchTab(tab); });
        });

        function renderRecentHome() {
          let recent = currentUser.transactions.slice(-3).reverse();
          let html = '';
          if (recent.length === 0) {
            html = '<p style="padding:10px 0;">No transactions yet.</p>';
          } else {
            recent.forEach(t => {
              let icon = t.type === 'sent' ? 'fa-arrow-up' : (t.type === 'received' ? 'fa-arrow-down' : 'fa-file-invoice');
              let sign = t.type === 'received' ? '+' : '-';
              let cls = t.type === 'received' ? 'positive' : 'negative';
              if (t.type === 'bill') sign = '-';
              html += `<div class="txn-item"><div class="txn-left"><div class="txn-icon"><i class="fas ${icon}"></i></div><div class="txn-details">${t.desc}<br><small>${t.date}</small></div></div><div class="txn-amount ${cls}">${sign}₹${t.amount}</div></div>`;
            });
          }
          document.getElementById('recentTransactionsHome').innerHTML = html;
        }

        function renderTransactionList(filter='all') {
          let filtered = currentUser.transactions;
          if (filter === 'sent') filtered = filtered.filter(t => t.type === 'sent');
          else if (filter === 'received') filtered = filtered.filter(t => t.type === 'received');
          else if (filter === 'bill') filtered = filtered.filter(t => t.type === 'bill');
          else if (filter === 'failed') filtered = filtered.filter(t => t.status === 'failed');
          let html = '';
          if (filtered.length === 0) {
            html = '<p>No transactions.</p>';
          } else {
            filtered.slice().reverse().forEach(t => {
              let icon = t.type === 'sent' ? 'fa-arrow-up' : (t.type === 'received' ? 'fa-arrow-down' : 'fa-file-invoice');
              let sign = t.type === 'received' ? '+' : '-';
              let cls = t.type === 'received' ? 'positive' : 'negative';
              if (t.type === 'bill') sign = '-';
              if (t.status === 'failed') cls = 'negative';
              html += `<div class="txn-item"><div class="txn-left"><div class="txn-icon"><i class="fas ${icon}"></i></div><div class="txn-details">${t.desc}<br><small>${t.date} • ${t.status}</small></div></div><div class="txn-amount ${cls}">${sign}₹${t.amount}</div></div>`;
            });
          }
          document.getElementById('transactionList').innerHTML = html;
        }

        const filterContainer = document.getElementById('historyFilters');
        if (filterContainer) {
          filterContainer.innerHTML = ['all','sent','received','bill','failed'].map(f => `<span class="filter-chip ${f==='all'?'active':''}" data-filter="${f}">${f.charAt(0).toUpperCase()+f.slice(1)}</span>`).join('');
          document.querySelectorAll('#historyFilters .filter-chip').forEach(chip => {
            chip.addEventListener('click', (e) => {
              document.querySelectorAll('#historyFilters .filter-chip').forEach(c => c.classList.remove('active'));
              chip.classList.add('active');
              renderTransactionList(chip.getAttribute('data-filter'));
            });
          });
        }

        document.getElementById('scanQrQuick').onclick = () => {
          if (window.qrcode) {
            qrCodeContainer.innerHTML = '';
            const qr = qrcode(0, 'M');
            qr.addData(currentUser.mobile);
            qr.make();
            qrCodeContainer.innerHTML = qr.createImgTag(5);
          } else {
            qrCodeContainer.innerHTML = '<p style="color:red;">QR library not loaded</p>';
          }
          qrMobileDisplay.innerText = currentUser.mobile;
          qrRecipientMobile.value = ''; qrAmount.value = ''; qrPassword.value = ''; qrMessage.innerHTML = '';
          overlay.classList.add('show'); qrModal.classList.add('show');
        };

        closeQrModal.onclick = () => { overlay.classList.remove('show'); qrModal.classList.remove('show'); };

        qrPayBtn.onclick = () => {
          const recipientMobile = qrRecipientMobile.value.trim();
          const amount = parseFloat(qrAmount.value);
          const password = qrPassword.value;

          if (!recipientMobile || recipientMobile.length !== 10) { qrMessage.innerHTML = '<span class="error-msg">Enter valid 10-digit mobile</span>'; return; }
          if (isNaN(amount) || amount <= 0) { qrMessage.innerHTML = '<span class="error-msg">Enter valid amount</span>'; return; }
          if (!password || password.length < 6) { qrMessage.innerHTML = '<span class="error-msg">Enter valid password (min 6 chars)</span>'; return; }
          if (password !== currentUser.password) { qrMessage.innerHTML = '<span class="error-msg">Incorrect password</span>'; return; }
          if (recipientMobile === currentUser.mobile) { qrMessage.innerHTML = '<span class="error-msg">You cannot pay yourself</span>'; return; }

          const recipient = registeredUsers.find(u => u.mobile === recipientMobile);
          if (!recipient) { qrMessage.innerHTML = '<span class="error-msg">Recipient not found</span>'; return; }
          if (recipient.active === false) { qrMessage.innerHTML = '<span class="error-msg">Recipient account is blocked</span>'; return; }
          if (amount > currentUserBalance) { qrMessage.innerHTML = '<span class="error-msg">Insufficient balance</span>'; return; }

          currentUserBalance -= amount;
          if (!recipient.balance) recipient.balance = 0;
          recipient.balance += amount;
          currentUser.balance = currentUserBalance;

          const sentTxn = { id: Date.now(), type: 'sent', to: recipientMobile, amount: amount, date: new Date().toISOString().slice(0,10), status: 'success', desc: `To ${recipientMobile}` };
          currentUser.transactions.push(sentTxn);

          const receivedTxn = { id: Date.now() + 1, type: 'received', from: currentUser.mobile, amount: amount, date: new Date().toISOString().slice(0,10), status: 'success', desc: `From ${currentUser.mobile}` };
          if (!recipient.transactions) recipient.transactions = [];
          recipient.transactions.push(receivedTxn);

          saveToLocalStorage();

          updateBalanceUI();
          renderRecentHome();
          qrMessage.innerHTML = '<span class="success-msg">Payment successful!</span>';
          qrRecipientMobile.value = ''; qrAmount.value = ''; qrPassword.value = '';
          showFloatArrow();
        };

        async function startCamera() {
          try {
            cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            scannerVideo.srcObject = cameraStream;
            await scannerVideo.play();
            scanInterval = setInterval(scanQR, 500);
          } catch (err) { alert('Camera access denied or not available.'); }
        }

        function stopCamera() {
          if (scanInterval) { clearInterval(scanInterval); scanInterval = null; }
          if (cameraStream) { cameraStream.getTracks().forEach(track => track.stop()); cameraStream = null; }
          scannerVideo.srcObject = null;
        }

        function scanQR() {
          if (scannerVideo.readyState !== scannerVideo.HAVE_ENOUGH_DATA) return;
          const canvas = scannerCanvas;
          const ctx = canvas.getContext('2d');
          canvas.width = scannerVideo.videoWidth;
          canvas.height = scannerVideo.videoHeight;
          ctx.drawImage(scannerVideo, 0, 0, canvas.width, canvas.height);
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const code = jsQR(imageData.data, canvas.width, canvas.height, { inversionAttempts: 'dontInvert' });
          if (code) {
            const mobile = code.data;
            if (/^\d{10}$/.test(mobile)) {
              stopCamera();
              cameraOverlay.classList.remove('show'); cameraModal.classList.remove('show');
              qrRecipientMobile.value = mobile; qrAmount.value = ''; qrPassword.value = ''; qrMessage.innerHTML = '';
              overlay.classList.add('show'); qrModal.classList.add('show');
            }
          }
        }

        homeCameraBtn.onclick = () => { cameraOverlay.classList.add('show'); cameraModal.classList.add('show'); startCamera(); };
        profileCameraBtn.onclick = () => { cameraOverlay.classList.add('show'); cameraModal.classList.add('show'); startCamera(); };
        closeCameraBtn.onclick = () => { stopCamera(); cameraOverlay.classList.remove('show'); cameraModal.classList.remove('show'); };
        cameraOverlay.onclick = () => { stopCamera(); cameraOverlay.classList.remove('show'); cameraModal.classList.remove('show'); };

        document.getElementById('sendToMobileQuick').onclick = () => {
          switchTab('transfer');
          document.getElementById('transferFormContainer').innerHTML = `
            <div class="card"><h4>Send to mobile</h4><input class="input-field" id="mobileNum" placeholder="Mobile number (10 digits)"><input class="input-field" id="amountMobile" type="number" placeholder="Amount"><button class="btn-primary" id="doMobileSend">Send</button></div>
          `;
          document.getElementById('doMobileSend').onclick = () => {
            let mobile = document.getElementById('mobileNum').value;
            let amt = parseFloat(document.getElementById('amountMobile').value);
            if (!/^\d{10}$/.test(mobile)) { alert('Invalid mobile'); return; }
            if (amt > currentUserBalance) { alert('Insufficient balance'); return; }
            const recipient = registeredUsers.find(u => u.mobile === mobile);
            if (!recipient) { alert('Recipient not found'); return; }
            document.getElementById('transferMessage').innerHTML = '<div class="loading-overlay"><span class="spinner"></span> Processing...</div>';
            setTimeout(()=>{
              currentUserBalance -= amt;
              recipient.balance = (recipient.balance || 0) + amt;
              currentUser.balance = currentUserBalance;
              const transaction = { id: Date.now(), type: 'sent', to: mobile, amount: amt, date: new Date().toISOString().slice(0,10), status: 'success', desc: `To ${mobile}` };
              currentUser.transactions.push(transaction);
              const recTxn = { id: Date.now()+1, type: 'received', from: currentUser.mobile, amount: amt, date: new Date().toISOString().slice(0,10), status: 'success', desc: `From ${currentUser.mobile}` };
              if (!recipient.transactions) recipient.transactions = [];
              recipient.transactions.push(recTxn);
              saveToLocalStorage();
              updateBalanceUI();
              document.getElementById('transferMessage').innerHTML = '<span class="success-msg">Sent successfully</span>';
              document.getElementById('transferFormContainer').innerHTML = '';
              renderRecentHome();
              showFloatArrow();
            },1500);
          };
        };

        function setupAddMoney(btnId, phoneId, passwordId, amountId, msgId, codeDisplayId, codeBtnId) {
          document.getElementById(btnId).addEventListener('click', () => {
            const phone = document.getElementById(phoneId).value.trim();
            const pass = document.getElementById(passwordId).value;
            const amount = parseFloat(document.getElementById(amountId).value);
            const msgDiv = document.getElementById(msgId);

            if (!phone) { msgDiv.innerHTML = '<span class="error-msg">Enter phone number</span>'; return; }
            if (!pass || pass.length < 6) { msgDiv.innerHTML = '<span class="error-msg">Enter valid password (min 6 chars)</span>'; return; }
            if (isNaN(amount) || amount <= 0) { msgDiv.innerHTML = '<span class="error-msg">Enter valid amount</span>'; return; }
            if (pass !== currentUser.password) { msgDiv.innerHTML = '<span class="error-msg">Incorrect password</span>'; return; }

            msgDiv.innerHTML = '<div class="loading-overlay"><span class="spinner"></span> Processing...</div>';
            setTimeout(() => {
              currentUserBalance += amount;
              currentUser.balance = currentUserBalance;
              const transaction = { id: Date.now(), type: 'received', from: 'self', amount: amount, date: new Date().toISOString().slice(0,10), status: 'success', desc: 'Money added to wallet' };
              currentUser.transactions.push(transaction);
              updateBalanceUI();
              saveToLocalStorage();
              msgDiv.innerHTML = `<span class="success-msg">₹${amount} added successfully!</span>`;
              document.getElementById(phoneId).value = ''; document.getElementById(passwordId).value = ''; document.getElementById(amountId).value = '';
              renderRecentHome();
              showFloatArrow();
            }, 1500);
          });

          document.getElementById(codeBtnId).addEventListener('click', () => {
            const code = Math.floor(100000 + Math.random() * 900000);
            document.getElementById(codeDisplayId).innerHTML = `Generated Code: <strong>${code}</strong>`;
            setTimeout(() => { document.getElementById(codeDisplayId).innerHTML = ''; }, 5000);
          });
        }

        setupAddMoney('addMoneyBtnHome', 'addPhoneHome', 'addPasswordHome', 'addAmountHome', 'addMoneyMessageHome', 'generatedCodeDisplayHome', 'generateCodeBtnHome');
        setupAddMoney('addMoneyBtnProfile', 'addPhoneProfile', 'addPasswordProfile', 'addAmountProfile', 'addMoneyMessageProfile', 'generatedCodeDisplayProfile', 'generateCodeBtnProfile');

        document.getElementById('changeUpiPinBtn').onclick = ()=>{
          document.getElementById('profileMessage').innerHTML = `<div class="card"><input class="input-field" type="password" placeholder="Old PIN"><input class="input-field" type="password" placeholder="New PIN"><button class="btn-primary">Change PIN (demo)</button></div>`;
        };
        document.getElementById('viewBankAccounts').onclick = ()=>{
          let accHtml = '<div class="profile-row"><span>HDFC Bank x1234</span> <span>₹45200</span></div><div class="profile-row"><span>SBI x5678</span> <span>₹8900</span></div>';
          document.getElementById('profileMessage').innerHTML = `<div class="card">${accHtml}</div>`;
        };
        document.getElementById('logoutBtn').onclick = ()=>{
          alert('Logged out');
          appScreen.classList.remove('show');
          authScreen.style.display = 'block';
          document.getElementById('loginMobile').value = ''; document.getElementById('loginPassword').value = ''; document.getElementById('loginError').innerText = '';
          loginCard.style.display = 'block'; signupCard.style.display = 'none';
        };

        document.getElementById('viewAllHistory').onclick = (e)=>{ e.preventDefault(); switchTab('history'); };

        updateBalanceUI();
        renderRecentHome();
        renderTransactionList('all');
        switchTab('home');
      }

      totalPages = Math.ceil(registeredUsers.length / pageSize) || 1;
    })();
  </script>
</body>
</html>